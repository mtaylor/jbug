<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>README - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body class="file">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./README_rdoc.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation" class="description">
  
<h1 id="label-JBug+Newcastle%3A+Ruby+on+Rails+on+TorqueBox">JBug Newcastle: Ruby on Rails on TorqueBox</h1>

<h2 id="label-1.+Installation">1. Installation</h2>

<h3 id="label-Prerequisites">Prerequisites</h3>

<pre>yum install -y gcc-c++ patch readline readline-devel zlib zlib-devel libyaml-devel libffi-devel openssl-devel make bzip2 autoconf automake libtool bison iconv-devel java</pre>

<h3 id="label-RVM">RVM</h3>

<pre># Run as user not root
curl -L https://get.rvm.io | bash -s stable
source ~/.bash_profile</pre>

<p>Check out your personal message from Wayne.  So compassionate!</p>

<h3 id="label-JRuby">JRuby</h3>

<pre>rvm install jruby</pre>

<h3 id="label-TorqueBox">TorqueBox</h3>

<pre>rvm use jruby
rvm gemset create torquebox
rvm use jruby-1.6.7.2@torquebox

jruby -J-Xmx1024m -S gem install torquebox-server</pre>

<h2 id="label-Running+TorqueBox">Running TorqueBox</h2>

<p>TorqueBox creates a command line tool for managing your torquebox server. 
You can checkout the avaiable commands through:</p>

<pre>torquebox</pre>

<p>You can also checkout which versions of JBOSS, JRUBY and TORQUEBOX you are
using.</p>

<pre>torquebox env</pre>

<h3 id="label-Starting+TorqueBox">Starting TorqueBox</h3>

<pre>torquebox run</pre>

<h3 id="label-Install+rails">Install rails</h3>

<pre>gem install rails</pre>

<h2 id="label-2.+Face+Blog">2. Face Blog</h2>

<p>Now that you have everything installed, you’re ready to rock n roll. 
It’s time to create your first rails application.  You’re going to
create a new social networking site called Face Blog.</p>

<h2 id="label-Creating+a+Rails+App">Creating a Rails App</h2>

<p>First thing you need to do is create a rails application.</p>

<pre>rails new face_blog</pre>

<p>Notice the file structure.  Every rails app looks the same.  This makes it
easy to quickly get involved in other rails projects.  The main areas
you’ll be working in today are:</p>

<p>app/* =&gt; Contains all your MVC files config/ =&gt; Used to configure
your app db =&gt; where migrations and schema lives</p>

<h2 id="label-Adding+gems">Adding gems</h2>

<p>First thing we’re going to add to our site is a User.  We want to allow
the user to login, signup and all that jazz.  But of course we’re not
going to write all that ourselves.  We’ll use a library to do the grunt
work for us.</p>

<p>We’re going to add “devise” (an authentication mechanism for rails)
to our gem file</p>

<p>In the Gemfile, under</p>

<pre>gem &quot;rails&quot;, &quot;3.2.3&quot;</pre>

<p>Add</p>

<pre>gem devise</pre>

<p>Then run bundler to pull in the dependecies into our gemset.</p>

<pre>bundle update</pre>

<p>Devise is a rails engine (<a
href="http://guides.rubyonrails.org/engines.html">guides.rubyonrails.org/engines.html</a>),
don’t worry about what engines are right now, we just need to know that
we need to run some tasks specific to devise.</p>

<pre>rails devise:install
rails generate devise:views</pre>

<h2 id="label-Models+and+Migrations">Models and Migrations</h2>

<p>To create our user model we’ll use a model generator.  We don’t always
have to stick to the generators that come with rails.  3rd party libraries
can also offer generators.  To see which generators you have avaiable to
you.  You can run</p>

<pre>rails generate</pre>

<p>For our user model we’ll use the devise generator.</p>

<pre>rails generate devise User name:string dob:date</pre>

<p>If you look at the migration that devise created (under db/migrate) you can
see the extra information devise has added to support all forms of
authentication.</p>

<p>Now that we’ve added some migrations we must migrate the database.</p>

<pre>rake db:migrate</pre>

<p>We’re also going to make the our attributes pubic.  We do this by setting
the attr_accessible method offered by ActiveRecord::Base.  Open up the
model app/models/user.rb and add in :name and :dob to the attr_accessible
method:</p>

<pre>attr_accessible :email, :password, :password_confirmation, :remember_me, :name, :dob</pre>

<h2 id="label-Validations">Validations</h2>

<p>You can now test out your model in the rails console.</p>

<pre class="ruby"><span class="ruby-identifier">rails</span> <span class="ruby-identifier">c</span>

<span class="ruby-identifier">$&gt;</span> <span class="ruby-identifier">me</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Martyn&quot;</span>, :<span class="ruby-identifier">dob</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;22/11/1984&quot;</span>)
</pre>

<p>What happens why you try to save me</p>

<pre>$&gt; me.save!</pre>

<p>This happens because devise has added in some extra validation to our
model.  We must enter an email, password, password_confirmation when
creating a new user.  Let’s try again.</p>

<pre class="ruby"><span class="ruby-identifier">$&gt;</span> <span class="ruby-identifier">me</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Martyn&quot;</span>, :<span class="ruby-identifier">dob</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;22/11/1984&quot;</span>, :<span class="ruby-identifier">email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;mtaylor@redhat.com&quot;</span>, :<span class="ruby-identifier">password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>, :<span class="ruby-identifier">password_confirmation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>)
<span class="ruby-identifier">$&gt;</span> <span class="ruby-identifier">me</span>.<span class="ruby-identifier">save!</span>
</pre>

<p>Voila it works.  We can now be pretty confident our user works.</p>

<h4 id="label-NOTE%3A+">NOTE: </h4>

<p>Through out this practical your going to create many users.  Devise has a
uniqueness validation on email address.  If you get complaints from Devise,
you can just delete conflicting users.  To delete just call the destroy
method on the user; you can delete all users using the command below:</p>

<pre class="ruby"><span class="ruby-comment"># Delete a single user</span>
<span class="ruby-identifier">me</span>.<span class="ruby-identifier">destroy</span>

<span class="ruby-comment"># Delete All Users</span>
<span class="ruby-constant">User</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">destroy</span> }
</pre>

<p>Now we’ve seen devise validations in action, its time to add our own. 
Face Blog is for over 18s only and user must supply a name.  Let’s start
by adding validation to make sure name is not empty.  Open up the user
model, add in name validation.</p>

<pre class="ruby"><span class="ruby-identifier">validates</span> :<span class="ruby-identifier">name</span>, :<span class="ruby-identifier">presence</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, :<span class="ruby-identifier">length</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">minimum</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> }
</pre>

<p>This makes sure that a user supplies a name and its length greater than or
equal to 2</p>

<p>Now time for checking the age.  We could use the rails helper methods for
checking the age.  But instead we’re going to create a custom method to
stop underage users signing up.</p>

<pre class="ruby"><span class="ruby-identifier">validates</span> :<span class="ruby-identifier">dob</span>, :<span class="ruby-identifier">presence</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-identifier">validate</span> :<span class="ruby-identifier">must_be_an_adult</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">must_be_an_adult</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-value">18</span>.<span class="ruby-identifier">years</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">dob</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(:<span class="ruby-identifier">age</span>, <span class="ruby-string">&quot;must be over 18&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Try it out to see if its working.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">create!</span>(:<span class="ruby-identifier">email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;mtaylor@redhat.com&quot;</span>, :<span class="ruby-identifier">password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>, :<span class="ruby-identifier">password_confirmation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>, :<span class="ruby-identifier">dob</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;01/01/2010&quot;</span>, :<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;&quot;</span>)
</pre>

<h2 id="label-Associations">Associations</h2>

<p>Face Blog allows users to add friends.  To do this wel’ll need an extra
model, we’ll call it friendship.  This will be used to store mappings
between users.  We’ll setup model assoications to acheive the ERD show
below:</p>

<p><img src="images/first_model_erd.png" /></p>

<p>To start we need to create the extra friendship model.  We’ll use a
generator to do this.</p>

<pre>rails generate model Friendship user_id:integer friend_id:string</pre>

<p>Note the naming convention here.  When we setup associations in rails,
ActiveRecord automatically looks for a foreign key named
&lt;association_name&gt;_id.  It’s possible to override this, but we’ll
stick to convention for now to make it easy.</p>

<p>Next we need to add in the association into the models.</p>

<p>In the friendship model we add two associations</p>

<pre class="ruby"><span class="ruby-identifier">belongs_to</span> :<span class="ruby-identifier">user</span>
<span class="ruby-identifier">belongs_to</span> :<span class="ruby-identifier">friend</span>, :<span class="ruby-identifier">class_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;User&quot;</span>
</pre>

<p>these associations link up the two ids we store to User objects.  For each
friendship we can now get the User (the owner of the friendship) and the
Friend (which is another User).</p>

<p>Now lets do the same on the User side.</p>

<pre class="ruby"><span class="ruby-identifier">has_many</span> :<span class="ruby-identifier">friendships</span>
<span class="ruby-identifier">has_many</span> :<span class="ruby-identifier">friends</span>, :<span class="ruby-identifier">through</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">friendships</span>
</pre>

<p>The last association is more of a convenience method.  Really we want to
deal with friends not with friendships, ActiveRecord will look at the
friendship Model for an association called :friend which we defined
previously.</p>

<p>Now time to test it all out.  Lets create 2 users and make them friends
with one another.</p>

<pre class="ruby"><span class="ruby-comment"># User 1</span>
<span class="ruby-identifier">martyn</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">create!</span>(:<span class="ruby-identifier">email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;mtaylor@redhat.com&quot;</span>, :<span class="ruby-identifier">password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>, :<span class="ruby-identifier">password_confirmation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>, :<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;martyn&quot;</span>, :<span class="ruby-identifier">dob</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;22/11/1984&quot;</span>)

<span class="ruby-comment"># User 2</span>
<span class="ruby-identifier">dave</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">create!</span>(:<span class="ruby-identifier">email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;dave@redhat.com&quot;</span>, :<span class="ruby-identifier">password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>, :<span class="ruby-identifier">password_confirmation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;password&quot;</span>, :<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Dave&quot;</span>, :<span class="ruby-identifier">dob</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;01/01/1950&quot;</span>)

<span class="ruby-comment"># Add dave as a friend</span>
<span class="ruby-identifier">martyn</span>.<span class="ruby-identifier">friends</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">dave</span>
<span class="ruby-identifier">martyn</span>.<span class="ruby-identifier">save!</span>

<span class="ruby-comment"># Check the relation</span>
<span class="ruby-identifier">martyn</span>.<span class="ruby-identifier">friends</span>
</pre>

<p>You might have noticed that dave still has no friends.  This is becuase we
only set up the association in one direction.  We could add the inverse
assoications to the user model, which would solve this issue.  But for the
sake of simplicity we’ll simply add an extra friendship entry.</p>

<pre># Add Martyn as Daves friend
dave.friends &lt;&lt; martyn
dave.save!</pre>

<h3 id="label-Overview">Overview</h3>

<p>There you have it.  You’ve successfully managed to create new models,
migrations add validation and setup associations.  All in the space of a
few minutes.  Next we’ll start building up the Controller and View side
of our applicaton.  We’re going to need a ruby server running to test
this.  If you haven’t already, check out the Running TorqueBox section. 
If your having trouble with TorqueBox don’t worry you can just use the
default ruby server for testing purposes.  To start it:</p>

<pre>rails s</pre>

<h2 id="label-Controllers+and+Views">Controllers and Views</h2>

<p>Now that we have the models complete.  We can start building our web
application.  The first thing we’re going to do is add in a controller
and some views for managing our User.  Rails has a scaffolding mcahnism
that generates a controller and views for standard CRUD operations.  As
we’ll see in a moment, these operations are associated with HTTP verbs
and respond to endpoints conventional to REST.</p>

<p>we’ll need to temporarily disable the devise namespace as it will
conflict with out scaffold.  Open up config/routes.rb and comment out this
line.</p>

<pre># devise_for :users</pre>

<p>Now, lets run the scaffold.  Since we’ve already created our migration we
tell rails to skip it, we also tell rails to skip any files that conflict
with the generated files, such as our user model.</p>

<pre>rails generate scaffold User --skip-migration --skip</pre>

<p>You’ll notce that rails create a bunch of files.  Ignore these, for now
We’re only intersted in the controller, views, and routes.rb.</p>

<p>Next thing we’ll do is add our root route.  This the route that is
initiated when a user first navigates to your application.  We’ll set
this as the index action of our users controller.  In routes.rb add:</p>

<pre class="ruby"><span class="ruby-identifier">root</span> :<span class="ruby-identifier">to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'users#index'</span>
</pre>

<p>whilst we’re here we can uncomment the devise_for :users</p>

<pre>devise_for :users</pre>

<p>Now, we just need to remove the default index.html file</p>

<pre>rm -f public/index.html</pre>

<p>We’ll add in some mock data so we can see the site in action.</p>

<pre>rake db:seed</pre>

<p>Lets start up the server and see it in action.</p>

<pre>torquebox deploy
torquebox run</pre>

<p>Once torquebox has started navigate to <a
href="http://localhost:8080">localhost:8080</a></p>

<p>It’s not particularly exciting right now.  But we’ll jazz it up later.</p>

<p>The first thing we want to do is to add some links for logging in and out. 
Since we want these on each page we visit, we’ll add them to the
application layout.  Open up app/views/applicaton.html.erb and add in the
following content in the body tag before yield.</p>

<pre>&lt;header&gt;
  &lt;% if user_signed_in? %&gt;
     &lt;%= &quot;Hello  #{current_user.name}&quot; %&gt; |
     &lt;%= link_to('Logout', destroy_user_session_path, :method =&gt; :delete) %&gt;
  &lt;% else %&gt;
      &lt;%= link_to('Login', new_user_session_path)  %&gt; |
      &lt;%= link_to('Register', new_user_registration_path) %&gt;
  &lt;% end %&gt;
&lt;/header&gt;</pre>

<p>Devise gives us helper methods to get the current_user and to check if a
user is logged in.</p>

<p>Next we’ll update the devise new registration view so that we can
retrieve the name and dob.  Open up
app/views/devise/registrations/new.html.erb and add in our extra content
under the email section.  Notice we use the form helper methods here:</p>

<pre>&lt;div&gt;&lt;%= f.label :name %&gt;&lt;br /&gt;
&lt;%= f.text_field :name %&gt;&lt;/div&gt;

&lt;div&gt;&lt;%= f.label :dob %&gt;&lt;br /&gt;
&lt;%= f.date_select :dob, :start_year =&gt; 1900 %&gt;&lt;/div&gt;</pre>

<p>Great.  Now we can login, register and view users.  Next we want to allow
users to add friends.  To handle friendships we’ll create a new
controller:</p>

<pre>rails generate controller friendships create destroy</pre>

<p>Since we didn’t, we’ll have to implement the actions ourselves.  Open
up app/controllers/friendships_controller.rb and add in our business logic.</p>

<p>create and destory are our actions.  In each action we use the params to
retrieve the id of the resource we’re working on.  In both cases we’re
using the params to retreive the ID of the friend, then we’re simply
adding or removing it from our current users friends.</p>

<p>class FriendshipsController &lt; ApplicationController</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
  <span class="ruby-identifier">friend</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">id</span>])

  <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">friends</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">friend</span>
  <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">friends</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">friends</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">id</span>]))
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>
<span class="ruby-keyword">end</span>
</pre>

<p>end</p>

<p>Next let’s update the users list page and add in links for adding and
removing friends.</p>

<p>We’re going to customise this page a little whilst we’re here.  We’ll
remove the new, edit and destroy links and add in some links to handle
adding and removing friends.  Notice we use the devise helper methods
‘current_user’ inline with our html to determine when to show the
friendship links.  We also use our friendship relation to check which users
the current_user is friends with.</p>

<p>&lt;table&gt;</p>

<pre>&lt;% @users.each do |user| %&gt;
  &lt;tr&gt;
    &lt;!-- Here we're adding a few place holders so we can tart it up later --&gt;
    &lt;td class='avatar'&gt;
    &lt;/td&gt;
    &lt;td class='info'&gt;
      &lt;%= link_to user.name, user %&gt;
    &lt;/td&gt;

    &lt;td class='links'&gt;
      &lt;!-- check to see if a current_user exists i.e. is a user logged in --&gt;
      &lt;% if current_user %&gt;
        &lt;!-- If the current user is friends with the user we are working with, then display 'remove friend' else 'add friend' --&gt;
        &lt;% if current_user.friends.include?(user) %&gt;
          &lt;%= link_to 'Remove Friend', friendship_path(:id =&gt; user), :method =&gt; :delete %&gt;
        &lt;% else %&gt;
          &lt;%= link_to 'Add Friend', friendships_path(:id =&gt; user), :method =&gt; :post %&gt;
        &lt;% end %&gt;
      &lt;% end %&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;</pre>

<p>&lt;/table&gt;</p>

<p>Lastly We add a section on our show user page to list their friends and do
a little tidying up.</p>

<p>&lt;div id=“info”&gt;</p>

<pre>&lt;div id=&quot;avatar&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;user_info&quot;&gt;
  &lt;%= @user.name %&gt;&lt;/br&gt;
  &lt;%= @user.dob %&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&quot;contact&quot;&gt;
  &lt;%= @user.email %&gt;
&lt;/div&gt;

&lt;!-- iterate over @users friends (we set @user in the controller) --&gt;
&lt;div id=&quot;friends&quot;&gt;
  &lt;h3&gt;Friends&lt;/h3&gt;
  &lt;% @user.friends.each do |user| %&gt;
    &lt;div id=&quot;friend&quot;&gt;&lt;%= link_to user.name, user_path(user) %&gt;&lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;</pre>

<p>&lt;/div&gt;</p>

<p>Now login/register and make some friends, then navigate to your user page. 
You should be able to see a list of your friends.  Fantastic.</p>

<p>Now our website functions as we want it, we can add a bit of style.</p>

<p>copy the ‘application.css’ and images found in the
src/assets/stylesheets src/assets/images directory into your applications
app/assets/stylesheets and app/assets/images directories.  Refresh your
browser and take a moment to awe at your magnificant creation.</p>

<h3 id="label-Overview">Overview</h3>

<p>In this section we looked at controllers and views.  We seen how they are
linked together through render and through exposing global variables.  We
took a brief look at some of rails form helper methods and at the link_to
helper.  We’ve only scratched the surface of what is possible with rails
at this point.  You can find detailed information on rails helpers,
controllers, routes and whole lot more here:</p>

<p><a href="http://guides.rubyonrails.org/">guides.rubyonrails.org/</a></p>

<h2 id="label-TorqueBox+Messaging">TorqueBox Messaging</h2>

<p>EVerything we’ve used so far has been strictly rails only.  Now its time
to take a look at some of the cool features we get from TorqueBox.  We’re
going to add the ability for users to subscribe to their friends and to
create posts.  We’ll use TorqueBox messaging to do all this for us. 
TorqueBox messaging is simply a ruby wrapper around JBoss’s super fast,
high performance Messaging solution, HornetQ.  To find out more about
HornetQ visit: <a
href="https://www.jboss.org/hornetq">www.jboss.org/hornetq</a>  For more
information about TorqueBox and TorquBox messaging you can checkout their
website and documentation here: <a
href="http://torquebox.org/">torquebox.org/</a></p>

<h3 id="label-Adding+Messaging+to+Face+Blog.">Adding Messaging to Face Blog.</h3>

<p>rails generate scaffold Message user_id:integer subject:string body:text
create</p>

<p>add</p>

<p>belongs_to :user to message has_many :messages to user</p>

<pre>## note you have to move the css into the 2</pre>

<p>&lt;div id=“info”&gt;</p>

<pre>&lt;div id=&quot;avatar&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;user_info&quot;&gt;
  &lt;%= @user.name %&gt;&lt;/br&gt;
  &lt;%= @user.dob %&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&quot;contact&quot;&gt;
  &lt;%= @user.email %&gt;
&lt;/div&gt;

&lt;!-- iterate over @users friends (we set @user in the controller) --&gt;
&lt;div id=&quot;friends&quot;&gt;
  &lt;h3&gt;Friends&lt;/h3&gt;
  &lt;% @user.friends.each do |user| %&gt;
    &lt;div id=&quot;friend&quot;&gt;&lt;%= link_to user.name, user_path(user) %&gt;&lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;</pre>

<p>&lt;/div&gt; &lt;div id=“messages”&gt;</p>

<pre>&lt;!-- Form for creating messages --&gt;
&lt;div id=&quot;create_message&quot;&gt;
      &lt;% if current_user%&gt;
    &lt;%= form_for Message.new do |f| %&gt;
      &lt;%= f.text_field :body, :class =&gt; &quot;message&quot; %&gt;
      &lt;%= f.submit &quot;Send&quot;, :class =&gt; &quot;message_send&quot; %&gt;
    &lt;% end %&gt;
 &lt;% end %&gt;
&lt;/div&gt;

&lt;!-- Display this users messages --&gt;
&lt;div id=&quot;show_messages&quot;&gt;
      &lt;table&gt;
    &lt;% @user.messages.reverse.each do | message | %&gt;
    &lt;tr class='message'&gt;
      &lt;td class=&quot;message_avatar&quot;&gt;&lt;/td&gt;
      &lt;td class=&quot;message_details&quot;&gt;&lt;%= message.user.name %&gt;&lt;/td&gt;
      &lt;td class=&quot;message_body&quot;&gt;&lt;%= message.body %&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;% end %&gt;
  &lt;/table&gt;
&lt;/div&gt;</pre>

<p>&lt;/div&gt;</p>

<p>add torqueboxmessaging gem</p>

</div>



<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

